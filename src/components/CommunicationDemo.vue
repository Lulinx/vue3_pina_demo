<template>
  <div class="communication-demo">
    <h2>ğŸ”„ ç»„ä»¶é€šä¿¡æ–¹å¼å®Œå…¨æŒ‡å—</h2>

    <!-- 1. Props ä¼ å€¼ï¼ˆçˆ¶ä¼ å­ï¼‰-->
    <section class="section">
      <h3>1ï¸âƒ£ Props ä¼ å€¼ï¼ˆçˆ¶ä¼ å­ï¼‰</h3>
      <div class="example">
        <ChildComponent :message="parentMessage" :count="counter" :user="userData" />
        <div class="explanation">
          <p>çˆ¶ç»„ä»¶å‘å­ç»„ä»¶ä¼ é€’æ•°æ®ï¼šmessageã€countã€user</p>
          <p>å­ç»„ä»¶é€šè¿‡ defineProps æ¥æ”¶è¿™äº›æ•°æ®</p>
        </div>
      </div>
    </section>

    <!-- 2. Emit äº‹ä»¶ï¼ˆå­ä¼ çˆ¶ï¼‰-->
    <section class="section">
      <h3>2ï¸âƒ£ Emit äº‹ä»¶ï¼ˆå­ä¼ çˆ¶ï¼‰</h3>
      <div class="example">
        <ChildEmitComponent @child-message="handleChildMessage" />
        <p v-if="childMessage" class="result">ğŸ“¨ å­ç»„ä»¶å‘é€çš„æ¶ˆæ¯ï¼š{{ childMessage }}</p>
        <div class="explanation">
          <p>å­ç»„ä»¶ä½¿ç”¨ emit å‘çˆ¶ç»„ä»¶å‘é€äº‹ä»¶</p>
          <p>çˆ¶ç»„ä»¶ä½¿ç”¨ @event-name ç›‘å¬è¿™äº›äº‹ä»¶</p>
        </div>
      </div>
    </section>

    <!-- 3. v-model åŒå‘ç»‘å®š -->
    <section class="section">
      <h3>3ï¸âƒ£ v-model åŒå‘ç»‘å®š</h3>
      <div class="example">
        <ChildVModelComponent v-model:title="formData.title" v-model:content="formData.content" />
        <div class="result">
          <p>æ ‡é¢˜ï¼š{{ formData.title }}</p>
          <p>å†…å®¹ï¼š{{ formData.content }}</p>
        </div>
        <div class="explanation">
          <p>ä½¿ç”¨ v-model:prop å®ç°åŒå‘æ•°æ®ç»‘å®š</p>
          <p>å­ç»„ä»¶æ¥æ”¶æ•°æ®å¹¶å¯ä»¥ä¿®æ”¹ï¼Œçˆ¶ç»„ä»¶è‡ªåŠ¨æ›´æ–°</p>
        </div>
      </div>
    </section>

    <!-- 4. Store é€šä¿¡ï¼ˆå…„å¼Ÿç»„ä»¶é€šä¿¡ï¼‰-->
    <section class="section">
      <h3>4ï¸âƒ£ Store é€šä¿¡ï¼ˆå…¨å±€çŠ¶æ€ç®¡ç†ï¼‰</h3>
      <div class="example">
        <div class="store-info">
          <p>å½“å‰ Store è®¡æ•°ï¼š{{ counterStore.count }}</p>
          <button @click="counterStore.increment" class="btn btn-primary">Store +1</button>
          <button @click="counterStore.reset" class="btn btn-secondary">é‡ç½®</button>
        </div>
        <div class="explanation">
          <p>ä½¿ç”¨ Pinia Store ç®¡ç†å…¨å±€çŠ¶æ€</p>
          <p>æ‰€æœ‰ç»„ä»¶éƒ½å¯ä»¥è®¿é—®å’Œä¿®æ”¹ Store ä¸­çš„æ•°æ®</p>
          <p>ç‰¹åˆ«é€‚åˆè·¨è¶Šå¤šå±‚çº§ç»„ä»¶çš„é€šä¿¡</p>
        </div>
      </div>
    </section>

    <!-- 5. Provide/Inject ä¾èµ–æ³¨å…¥ -->
    <section class="section">
      <h3>5ï¸âƒ£ Provide/Inject ä¾èµ–æ³¨å…¥</h3>
      <div class="example">
        <ProvideInjectParent />
        <div class="explanation">
          <p>çˆ¶ç»„ä»¶é€šè¿‡ provide æä¾›æ•°æ®</p>
          <p>æ‰€æœ‰åä»£ç»„ä»¶éƒ½å¯ä»¥é€šè¿‡ inject è·å–æ•°æ®</p>
          <p>ä¸éœ€è¦é€çº§ä¼ é€’ props</p>
        </div>
      </div>
    </section>

    <!-- 6. Slots æ’æ§½ -->
    <section class="section">
      <h3>6ï¸âƒ£ Slots æ’æ§½</h3>
      <div class="example">
        <ChildSlotComponent>
          <template #header>
            <h4>ğŸ“ è‡ªå®šä¹‰å¤´éƒ¨</h4>
          </template>
          <template #default>
            <p>è¿™æ˜¯é»˜è®¤æ’æ§½çš„å†…å®¹</p>
          </template>
          <template #footer>
            <p>â­ è¿™æ˜¯é¡µè„šæ’æ§½</p>
          </template>
        </ChildSlotComponent>
        <div class="explanation">
          <p>é€šè¿‡æ’æ§½ä¼ é€’ HTML å†…å®¹è€Œä¸ä»…æ˜¯æ•°æ®</p>
          <p>æ”¯æŒå…·åæ’æ§½å’Œä½œç”¨åŸŸæ’æ§½</p>
          <p>æä¾›æ›´çµæ´»çš„ç»„ä»¶å®šåˆ¶</p>
        </div>
      </div>
    </section>

    <!-- 7. ref å’Œ expose ç›´æ¥è®¿é—® -->
    <section class="section">
      <h3>7ï¸âƒ£ ref å’Œ expose ç›´æ¥è®¿é—®</h3>
      <div class="example">
        <ChildRefComponent ref="childRef" />
        <button @click="callChildMethod" class="btn btn-primary">è°ƒç”¨å­ç»„ä»¶æ–¹æ³•</button>
        <p v-if="childRefResult" class="result">ğŸ“¤ å­ç»„ä»¶è¿”å›ï¼š{{ childRefResult }}</p>
        <div class="explanation">
          <p>é€šè¿‡ ref è·å–å­ç»„ä»¶å®ä¾‹</p>
          <p>å­ç»„ä»¶é€šè¿‡ expose æš´éœ²æ–¹æ³•å’Œå±æ€§</p>
          <p>çˆ¶ç»„ä»¶å¯ä»¥ç›´æ¥è°ƒç”¨å­ç»„ä»¶çš„æ–¹æ³•</p>
        </div>
      </div>
    </section>

    <!-- 8. $attrs å’Œ $listeners (Fallthrough Attributes) -->
    <section class="section">
      <h3>8ï¸âƒ£ $attrsï¼ˆå±æ€§ç©¿é€ï¼‰</h3>
      <div class="example">
        <ChildAttrsComponent data-test="custom" custom-attr="value" class="custom-class" />
        <div class="explanation">
          <p>æœªè¢« defineProps å£°æ˜çš„å±æ€§ä¼šè¢«ç©¿é€ä¼ é€’</p>
          <p>åœ¨å­ç»„ä»¶ä¸­å¯ä»¥é€šè¿‡ $attrs è®¿é—®</p>
          <p>ç”¨äºåˆ›å»ºé€šç”¨çš„åŒ…è£…ç»„ä»¶</p>
        </div>
      </div>
    </section>

    <!-- 9. é«˜çº§ï¼šè·¨ Store é€šä¿¡ -->
    <section class="section">
      <h3>9ï¸âƒ£ Store é—´çš„ä¾èµ–å’Œé€šä¿¡</h3>
      <div class="example">
        <div class="store-cross-communication">
          <p>äº§å“ç»Ÿè®¡ï¼š</p>
          <ul>
            <li>æ€»æ•°ï¼š{{ advancedStore.productStats.total }}</li>
            <li>æœ‰è´§ï¼š{{ advancedStore.productStats.inStock }}</li>
            <li>ç¼ºè´§ï¼š{{ advancedStore.productStats.outOfStock }}</li>
            <li>å¹³å‡ä»·æ ¼ï¼šÂ¥{{ advancedStore.productStats.averagePrice }}</li>
          </ul>
          <p>è®¢å•ç»Ÿè®¡ï¼š</p>
          <ul>
            <li>æ€»è®¢å•ï¼š{{ advancedStore.orderStats.total }}</li>
            <li>æ€»é‡‘é¢ï¼šÂ¥{{ advancedStore.orderStats.totalAmount }}</li>
            <li>å¹³å‡è®¢å•å€¼ï¼šÂ¥{{ advancedStore.orderStats.averageOrderValue }}</li>
          </ul>
        </div>
        <div class="explanation">
          <p>Store å¯ä»¥åœ¨ getters ä¸­äº’ç›¸å¼•ç”¨</p>
          <p>Store çš„ actions å¯ä»¥è°ƒç”¨å…¶ä»– Store çš„ actions</p>
          <p>å®ç°å¤æ‚çš„ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®æµ</p>
        </div>
      </div>
    </section>

    <!-- ä»£ç ç¤ºä¾‹ -->
    <section class="section code-section">
      <h3>ğŸ’» é€šä¿¡æ–¹å¼æ±‡æ€»è¡¨</h3>
      <table class="communication-table">
        <thead>
          <tr>
            <th>é€šä¿¡æ–¹å¼</th>
            <th>æ–¹å‘</th>
            <th>ç‰¹ç‚¹</th>
            <th>é€‚ç”¨åœºæ™¯</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Props</td>
            <td>çˆ¶ â†’ å­</td>
            <td>å•å‘æ•°æ®æµã€å“åº”å¼</td>
            <td>åŸºæœ¬æ•°æ®ä¼ é€’</td>
          </tr>
          <tr>
            <td>Emit</td>
            <td>å­ â†’ çˆ¶</td>
            <td>äº‹ä»¶é©±åŠ¨</td>
            <td>å­ç»„ä»¶é€šçŸ¥çˆ¶ç»„ä»¶</td>
          </tr>
          <tr>
            <td>v-model</td>
            <td>çˆ¶ â†” å­</td>
            <td>åŒå‘ç»‘å®šã€ç®€æ´</td>
            <td>è¡¨å•è¾“å…¥ç»„ä»¶</td>
          </tr>
          <tr>
            <td>Store</td>
            <td>ä»»æ„ â†” ä»»æ„</td>
            <td>å…¨å±€çŠ¶æ€ã€å“åº”å¼</td>
            <td>è·¨ç»„ä»¶çŠ¶æ€å…±äº«</td>
          </tr>
          <tr>
            <td>Provide/Inject</td>
            <td>ç¥–å…ˆ â†’ åä»£</td>
            <td>é¿å…propsç©¿é€ã€çµæ´»</td>
            <td>å¤šå±‚çº§ç»„ä»¶é€šä¿¡</td>
          </tr>
          <tr>
            <td>Slots</td>
            <td>çˆ¶ â†’ å­</td>
            <td>å†…å®¹åˆ†å‘ã€çµæ´»</td>
            <td>è‡ªå®šä¹‰ç»„ä»¶å†…å®¹</td>
          </tr>
          <tr>
            <td>ref/expose</td>
            <td>çˆ¶ â†’ å­</td>
            <td>ç›´æ¥è®¿é—®ã€å‘½ä»¤å¼</td>
            <td>éœ€è¦ç›´æ¥è°ƒç”¨æ–¹æ³•</td>
          </tr>
          <tr>
            <td>$attrs</td>
            <td>çˆ¶ â†’ å­</td>
            <td>å±æ€§ç©¿é€</td>
            <td>åŒ…è£…ç»„ä»¶ã€å±æ€§è½¬å‘</td>
          </tr>
        </tbody>
      </table>
    </section>
  </div>
</template>

<script setup>
import { ref, reactive, provide } from 'vue'
import { useCounterStore } from '@/stores/counterStore'
import { useAdvancedStore } from '@/stores/advancedStore'
import ChildComponent from './ChildComponent.vue'
import ChildEmitComponent from './ChildEmitComponent.vue'
import ChildVModelComponent from './ChildVModelComponent.vue'
import ProvideInjectParent from './ProvideInjectParent.vue'
import ChildSlotComponent from './ChildSlotComponent.vue'
import ChildRefComponent from './ChildRefComponent.vue'
import ChildAttrsComponent from './ChildAttrsComponent.vue'

// Store
const counterStore = useCounterStore()
const advancedStore = useAdvancedStore()

// Props ç¤ºä¾‹æ•°æ®
const parentMessage = ref('ğŸ‘‹ æ¥è‡ªçˆ¶ç»„ä»¶çš„é—®å€™')
const counter = ref(42)
const userData = reactive({
  name: 'å¼ ä¸‰',
  email: 'zhangsan@example.com',
  role: 'admin'
})

// Emit ç¤ºä¾‹
const childMessage = ref('')
const handleChildMessage = (message) => {
  childMessage.value = message
}

// v-model ç¤ºä¾‹
const formData = reactive({
  title: 'ç¼–è¾‘è¿™ä¸ªæ ‡é¢˜',
  content: 'ç¼–è¾‘è¿™ä¸ªå†…å®¹'
})

// ref ç¤ºä¾‹
const childRef = ref(null)
const childRefResult = ref('')
const callChildMethod = () => {
  if (childRef.value) {
    childRefResult.value = childRef.value.doSomething()
  }
}

// Provide/Inject ç¤ºä¾‹
const injectionData = reactive({
  theme: 'dark',
  language: 'zh-CN',
  user: { id: 1, name: 'å½“å‰ç”¨æˆ·' }
})
provide('injectionData', injectionData)
</script>

<style scoped>
.communication-demo {
  padding: 20px;
  background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
  min-height: 100vh;
}

.communication-demo h2 {
  text-align: center;
  color: #333;
  margin-bottom: 30px;
  font-size: 2rem;
}

.section {
  background: white;
  border-radius: 12px;
  padding: 25px;
  margin-bottom: 20px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

.section h3 {
  color: #667eea;
  margin-bottom: 15px;
  border-bottom: 2px solid #667eea;
  padding-bottom: 10px;
}

.example {
  margin: 20px 0;
  padding: 20px;
  background: #f9fafb;
  border-radius: 8px;
  border-left: 4px solid #667eea;
}

.explanation {
  margin-top: 15px;
  padding: 15px;
  background: #fffacd;
  border-radius: 6px;
  border-left: 4px solid #ffa500;
}

.explanation p {
  margin: 8px 0;
  color: #333;
  line-height: 1.6;
}

.result {
  padding: 10px;
  background: #e8f5e9;
  border-radius: 4px;
  color: #2e7d32;
  font-weight: 600;
  margin: 10px 0;
}

.btn {
  padding: 10px 20px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s;
  margin-right: 10px;
}

.btn-primary {
  background: #667eea;
  color: white;
}

.btn-primary:hover {
  background: #5568d3;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}

.btn-secondary {
  background: #e0e7ff;
  color: #667eea;
}

.btn-secondary:hover {
  background: #c7d2fe;
}

.store-info {
  padding: 15px;
  background: #e3f2fd;
  border-radius: 6px;
  border-left: 4px solid #2196f3;
}

.store-info p {
  margin: 10px 0;
  font-weight: 600;
  color: #1976d2;
}

.store-cross-communication {
  padding: 15px;
  background: #f3e5f5;
  border-radius: 6px;
}

.store-cross-communication p {
  font-weight: 600;
  color: #6a1b9a;
  margin-top: 15px;
}

.store-cross-communication ul {
  list-style: none;
  padding-left: 20px;
}

.store-cross-communication li {
  padding: 8px 0;
  color: #6a1b9a;
}

.store-cross-communication li:before {
  content: 'âœ“ ';
  color: #ab47bc;
  font-weight: bold;
}

.code-section {
  background: #1e1e1e;
}

.code-section h3 {
  color: #4ec9b0;
  border-bottom-color: #4ec9b0;
}

.communication-table {
  width: 100%;
  border-collapse: collapse;
  color: #fff;
  font-size: 0.9rem;
}

.communication-table thead {
  background: #333;
}

.communication-table th {
  padding: 15px;
  text-align: left;
  font-weight: 600;
  color: #4ec9b0;
}

.communication-table td {
  padding: 12px 15px;
  border-bottom: 1px solid #444;
  color: #bbb;
}

.communication-table tbody tr:hover {
  background: #2a2a2a;
}

@media (max-width: 768px) {
  .section {
    padding: 15px;
  }

  .communication-table {
    font-size: 0.75rem;
  }

  .communication-table th,
  .communication-table td {
    padding: 8px;
  }
}
</style>
